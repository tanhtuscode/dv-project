<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkateboardML Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .feature-section {
            margin-bottom: 2rem;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1.5rem;
        }
        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            padding: 1rem 1.5rem;
            border-radius: 0.375rem 0.375rem 0 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .stat-card {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 0.375rem;
        }
        .drag-drop-area {
            border: 2px dashed #ccc;
            border-radius: 0.375rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .drag-drop-area:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        .drag-drop-area.drag-over {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .result-item {
            padding: 0.75rem;
            margin: 0.5rem 0;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            background: #f8f9fa;
        }
        .progress-container {
            display: none;
            margin-top: 1rem;
        }
        .model-info-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
        }
        .auto-update-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #28a745;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-skateboard"></i> SkateboardML Platform</a>
            <span class="navbar-text">Professional ML Pipeline for Skateboard Trick Classification</span>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Dashboard Overview -->
        <div class="feature-section" style="position: relative;">
            <span class="auto-update-badge"><i class="fas fa-sync-alt"></i> Auto-Update Active</span>
            <div class="section-header">
                <h4 class="mb-0"><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h4>
            </div>
            
            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 class="text-primary">{{ stats.total_labels }}</h3>
                    <small>Available Labels</small>
                </div>
                <div class="stat-card">
                    <h3 class="text-success">{{ stats.train_samples }}</h3>
                    <small>Training Samples</small>
                </div>
                <div class="stat-card">
                    <h3 class="text-info">{{ stats.test_samples }}</h3>
                    <small>Test Samples</small>
                </div>
                <div class="stat-card">
                    <h3 class="text-warning">{{ stats.validation_samples }}</h3>
                    <small>Validation Samples</small>
                </div>
                <div class="stat-card">
                    <h3 class="text-secondary">{{ stats.total_samples }}</h3>
                    <small>Total Videos</small>
                </div>
            </div>

            <!-- Model Status -->
            {% if model_info %}
            <div class="model-info-box">
                <h5><i class="fas fa-brain"></i> Current Model: {{ model_info.name }}</h5>
                <div class="row">
                    <div class="col-md-3"><strong>Parameters:</strong> {{ "{:,}".format(model_info.total_params) }}</div>
                    <div class="col-md-3"><strong>Input Shape:</strong> {{ model_info.input_shape }}</div>
                    <div class="col-md-3"><strong>Output Shape:</strong> {{ model_info.output_shape }}</div>
                    <div class="col-md-3"><strong>Loaded:</strong> {{ model_info.loaded_time }}</div>
                </div>
            </div>
            {% endif %}

            <!-- Available Labels -->
            <div class="mb-3">
                <h6><i class="fas fa-tags"></i> Available Labels:</h6>
                <div class="d-flex flex-wrap gap-2">
                    {% for label in labels %}
                        <span class="badge bg-primary fs-6">{{ label }}</span>
                    {% endfor %}
                    <button class="btn btn-sm btn-outline-success" onclick="showCreateLabelModal()">
                        <i class="fas fa-plus"></i> Add Label
                    </button>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Column: Video Operations -->
            <div class="col-lg-8">
                <!-- Multi-Video Upload Section -->
                <div class="feature-section">
                    <div class="section-header">
                        <h4 class="mb-0"><i class="fas fa-cloud-upload-alt"></i> Multi-Video Upload & Processing</h4>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="drag-drop-area" id="uploadDropArea" onclick="document.getElementById('videoFiles').click()">
                                <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-3"></i>
                                <p class="mb-0">Click or drag videos here</p>
                                <small class="text-muted">Supports .mov, .mp4, .avi files</small>
                            </div>
                            <input type="file" id="videoFiles" multiple accept=".mov,.mp4,.avi" style="display: none;">
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Select Label:</label>
                                <select class="form-select" id="labelSelect">
                                    {% for label in labels %}
                                        <option value="{{ label }}">{{ label }}</option>
                                    {% endfor %}
                                </select>
                                <div class="mt-2">
                                    <input type="text" class="form-control" id="newLabelInput" placeholder="Or create new label...">
                                </div>
                            </div>
                            <button class="btn btn-primary w-100" onclick="uploadVideos()">
                                <i class="fas fa-upload"></i> Upload Videos
                            </button>
                        </div>
                    </div>

                    <div class="progress-container" id="progressContainer">
                        <div class="progress mb-2">
                            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                        </div>
                        <small id="progressText">Processing...</small>
                    </div>

                    <div class="mt-3" id="resultsContainer"></div>
                </div>

                <!-- Label Management Section -->
                <div class="feature-section">
                    <div class="section-header">
                        <h4 class="mb-0"><i class="fas fa-tags"></i> Label Management</h4>
                    </div>
                    
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>Warning:</strong> Removing a label will permanently delete all associated videos and features.
                    </div>

                    <div class="row">
                        <div class="col-md-8">
                            <div id="labelManagementList">
                                <!-- Labels will be loaded here -->
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="fas fa-broom"></i> Maintenance</h6>
                                    <p class="small text-muted">Remove orphaned entries from data lists</p>
                                    <button class="btn btn-sm btn-outline-primary w-100" onclick="cleanDataLists()">
                                        <i class="fas fa-broom"></i> Clean Data Lists
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Model Testing Section -->
                <div class="feature-section">
                    <div class="section-header">
                        <h4 class="mb-0"><i class="fas fa-microscope"></i> Model Testing & Upload</h4>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Upload Custom Model</h6>
                            <div class="drag-drop-area" onclick="document.getElementById('modelFile').click()">
                                <i class="fas fa-brain fa-2x text-muted mb-3"></i>
                                <p class="mb-0">Upload .keras or .h5 model</p>
                            </div>
                            <input type="file" id="modelFile" accept=".keras,.h5" style="display: none;">
                            <button class="btn btn-success w-100 mt-2" onclick="uploadModel()">Upload Model</button>
                        </div>
                        <div class="col-md-6">
                            <h6>Load Existing Model</h6>
                            <select class="form-select mb-2" id="existingModelSelect">
                                <option value="">Select a model...</option>
                                {% for model in available_models %}
                                    <option value="{{ model.path }}">{{ model.name }} ({{ model.modified }})</option>
                                {% endfor %}
                            </select>
                            <button class="btn btn-info w-100" onclick="loadExistingModel()">Load Model</button>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Test Model with Videos</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <input type="file" id="testVideoFiles" multiple accept=".mov,.mp4,.avi" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-warning w-100" onclick="testModel()">Test Model</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Data Management -->
            <div class="col-lg-4">
                <!-- Data Management Section -->
                <div class="feature-section">
                    <div class="section-header">
                        <h4 class="mb-0"><i class="fas fa-database"></i> Data Management</h4>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Label</th>
                                    <th>Videos</th>
                                    <th>Features</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for label, stats in label_stats.items() %}
                                <tr>
                                    <td><span class="badge bg-primary">{{ label }}</span></td>
                                    <td>{{ stats.videos }}</td>
                                    <td>{{ stats.features }}</td>
                                    <td>
                                        {% if stats.videos == stats.features %}
                                            <i class="fas fa-check text-success"></i>
                                        {% else %}
                                            <i class="fas fa-exclamation-triangle text-warning"></i>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary" onclick="regenerateDataLists()">
                            <i class="fas fa-sync"></i> Regenerate Data Lists
                        </button>
                        <button class="btn btn-outline-success" onclick="downloadDataLists()">
                            <i class="fas fa-download"></i> Download Data Lists
                        </button>
                        <button class="btn btn-outline-info" onclick="showDetailedStats()">
                            <i class="fas fa-chart-bar"></i> Detailed Statistics
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Create Label Modal -->
    <div class="modal fade" id="createLabelModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Label</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control" id="modalLabelName" placeholder="Enter label name">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createNewLabel()">Create</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal fade" id="resultsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Processing Results</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalResultsContent"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let selectedFiles = [];

        // Initialize drag and drop
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop();
            setupFileSelection();
        });

        function setupDragAndDrop() {
            const dropArea = document.getElementById('uploadDropArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });

            dropArea.addEventListener('drop', handleDrop, false);
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            document.getElementById('uploadDropArea').classList.add('drag-over');
        }

        function unhighlight(e) {
            document.getElementById('uploadDropArea').classList.remove('drag-over');
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function setupFileSelection() {
            document.getElementById('videoFiles').addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });

            document.getElementById('modelFile').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    uploadModel();
                }
            });
        }

        function handleFiles(files) {
            selectedFiles = Array.from(files);
            updateFileDisplay();
        }

        function updateFileDisplay() {
            const dropArea = document.getElementById('uploadDropArea');
            if (selectedFiles.length > 0) {
                dropArea.innerHTML = `
                    <i class="fas fa-video fa-2x text-success mb-3"></i>
                    <p class="mb-0">${selectedFiles.length} file(s) selected</p>
                    <small class="text-muted">Click to change selection</small>
                `;
            }
        }

        function uploadVideos() {
            if (selectedFiles.length === 0) {
                alert('Please select videos first');
                return;
            }

            const label = document.getElementById('labelSelect').value;
            const newLabel = document.getElementById('newLabelInput').value.trim();
            
            const formData = new FormData();
            
            if (newLabel) {
                formData.append('create_new_label', newLabel);
            } else {
                formData.append('label', label);
            }

            selectedFiles.forEach(file => {
                formData.append('videos', file);
            });

            showProgress();
            document.getElementById('progressText').textContent = 'Uploading and processing videos...';
            
            fetch('/upload_multiple_videos', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideProgress();
                showResults(data);
                if (data.success) {
                    // Show auto-update notification
                    showAutoUpdateNotification();
                    selectedFiles = [];
                    resetDropArea();
                    setTimeout(() => location.reload(), 2500);
                }
            })
            .catch(error => {
                hideProgress();
                alert('Error: ' + error.message);
            });
        }

        function showAutoUpdateNotification() {
            const notification = document.createElement('div');
            notification.className = 'alert alert-success alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 70px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-sync-alt fa-spin"></i>
                <strong>Auto-Update:</strong> Data lists (train/test/validation) have been regenerated!
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }

        function uploadModel() {
            const fileInput = document.getElementById('modelFile');
            if (fileInput.files.length === 0) {
                alert('Please select a model file');
                return;
            }

            const formData = new FormData();
            formData.append('model', fileInput.files[0]);

            fetch('/upload_model', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error: ' + error.message);
            });
        }

        function loadExistingModel() {
            const modelPath = document.getElementById('existingModelSelect').value;
            if (!modelPath) {
                alert('Please select a model');
                return;
            }

            const formData = new FormData();
            formData.append('model_path', modelPath);

            fetch('/load_model', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error: ' + error.message);
            });
        }

        function testModel() {
            const fileInput = document.getElementById('testVideoFiles');
            if (fileInput.files.length === 0) {
                alert('Please select test videos');
                return;
            }

            const formData = new FormData();
            Array.from(fileInput.files).forEach(file => {
                formData.append('videos', file);
            });

            showProgress();

            fetch('/batch_test_videos', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideProgress();
                if (data.success) {
                    showTestResults(data.results);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                hideProgress();
                alert('Error: ' + error.message);
            });
        }

        function showTestResults(results) {
            let html = '<h6>Model Test Results:</h6>';
            results.forEach(result => {
                if (result.error) {
                    html += `<div class="result-item border-danger">
                                <strong>${result.filename}</strong>
                                <div class="text-danger">${result.error}</div>
                             </div>`;
                } else {
                    html += `<div class="result-item border-success">
                                <strong>${result.filename}</strong>
                                <div>Predicted: <span class="badge bg-primary">${result.predicted_label}</span> (${result.confidence_percentage})</div>
                             </div>`;
                }
            });
            
            document.getElementById('modalResultsContent').innerHTML = html;
            const modal = new bootstrap.Modal(document.getElementById('resultsModal'));
            modal.show();
        }

        function showProgress() {
            document.getElementById('progressContainer').style.display = 'block';
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 90) {
                    clearInterval(interval);
                }
                document.getElementById('progressBar').style.width = Math.min(progress, 90) + '%';
            }, 500);
        }

        function hideProgress() {
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('progressBar').style.width = '100%';
            setTimeout(() => {
                document.getElementById('progressBar').style.width = '0%';
            }, 500);
        }

        function resetDropArea() {
            document.getElementById('uploadDropArea').innerHTML = `
                <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-3"></i>
                <p class="mb-0">Click or drag videos here</p>
                <small class="text-muted">Supports .mov, .mp4, .avi files</small>
            `;
        }

        function showResults(data) {
            let html = '';
            if (data.success) {
                html += `<div class="alert alert-success">${data.message}</div>`;
                
                if (data.results) {
                    html += '<div class="mt-3"><h6>Results:</h6>';
                    data.results.forEach(result => {
                        if (result.error) {
                            html += `<div class="result-item border-danger">
                                        <strong>${result.filename}</strong>
                                        <div class="text-danger">${result.error}</div>
                                     </div>`;
                        } else {
                            html += `<div class="result-item border-success">
                                        <strong>${result.filename}</strong>
                                        <div>Label: <span class="badge bg-success">${result.label}</span></div>
                                        <div class="text-success">✓ Features extracted</div>
                                     </div>`;
                        }
                    });
                    html += '</div>';
                }
            } else {
                html += `<div class="alert alert-danger">${data.message}</div>`;
            }
            
            document.getElementById('resultsContainer').innerHTML = html;
        }

        function showCreateLabelModal() {
            const modal = new bootstrap.Modal(document.getElementById('createLabelModal'));
            modal.show();
        }

        function createNewLabel() {
            const labelName = document.getElementById('modalLabelName').value.trim();
            if (!labelName) {
                alert('Please enter a label name');
                return;
            }

            const formData = new FormData();
            formData.append('label_name', labelName);

            fetch('/create_new_label', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    showAutoUpdateNotification();
                    bootstrap.Modal.getInstance(document.getElementById('createLabelModal')).hide();
                    setTimeout(() => location.reload(), 1500);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error: ' + error.message);
            });
        }

        function regenerateDataLists() {
            fetch('/regenerate_data_lists', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) location.reload();
                })
                .catch(error => alert('Error: ' + error.message));
        }

        function downloadDataLists() {
            window.location.href = '/download_data_lists';
        }

        function showDetailedStats() {
            fetch('/get_label_statistics')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        let html = '<div class="table-responsive"><table class="table table-striped"><thead><tr>' +
                                   '<th>Label</th><th>Videos</th><th>Features</th><th>Video Size</th><th>Feature Size</th></tr></thead><tbody>';
                        
                        for (const [label, stats] of Object.entries(data.statistics)) {
                            html += `<tr>
                                        <td><span class="badge bg-primary">${label}</span></td>
                                        <td>${stats.video_count}</td>
                                        <td>${stats.feature_count}</td>
                                        <td>${stats.video_size_mb} MB</td>
                                        <td>${stats.feature_size_mb} MB</td>
                                     </tr>`;
                        }
                        
                        html += '</tbody></table></div>';
                        
                        document.getElementById('modalResultsContent').innerHTML = html;
                        const modal = new bootstrap.Modal(document.getElementById('resultsModal'));
                        modal.show();
                    }
                })
                .catch(error => alert('Error: ' + error.message));
        }

        // Label Management Functions
        function loadLabelManagement() {
            fetch('/get_label_statistics')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        let html = '';
                        
                        for (const [label, stats] of Object.entries(data.statistics)) {
                            const totalFiles = stats.video_count + stats.feature_count;
                            const totalSize = (stats.video_size_mb + stats.feature_size_mb).toFixed(2);
                            
                            html += `
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-md-3">
                                                <h6 class="mb-0">
                                                    <span class="badge bg-primary">${label}</span>
                                                </h6>
                                            </div>
                                            <div class="col-md-6">
                                                <small class="text-muted">
                                                    <i class="fas fa-video"></i> ${stats.video_count} videos &nbsp;
                                                    <i class="fas fa-database"></i> ${stats.feature_count} features &nbsp;
                                                    <i class="fas fa-hdd"></i> ${totalSize} MB
                                                </small>
                                            </div>
                                            <div class="col-md-3 text-end">
                                                <button class="btn btn-sm btn-danger" onclick="confirmRemoveLabel('${label}', ${totalFiles})">
                                                    <i class="fas fa-trash-alt"></i> Remove
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                        
                        document.getElementById('labelManagementList').innerHTML = html;
                    }
                })
                .catch(error => console.error('Error loading labels:', error));
        }

        function confirmRemoveLabel(labelName, totalFiles) {
            const confirmed = confirm(
                `⚠️ WARNING: You are about to remove label "${labelName}"\n\n` +
                `This will permanently delete:\n` +
                `• All ${totalFiles} files (.MOV and .npy)\n` +
                `• All entries from train/test/validation lists\n` +
                `• The entire ${labelName} directory\n\n` +
                `This action CANNOT be undone!\n\n` +
                `Type the label name to confirm: ${labelName}`
            );
            
            if (!confirmed) {
                return;
            }
            
            const userInput = prompt(`Type "${labelName}" to confirm deletion:`);
            
            if (userInput !== labelName) {
                alert('Label name does not match. Deletion cancelled.');
                return;
            }
            
            removeLabel(labelName);
        }

        function removeLabel(labelName) {
            fetch('/remove_label', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ label: labelName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`✅ ${data.message}`);
                    showAutoUpdateNotification();
                    
                    // Reload page after 1.5 seconds
                    setTimeout(() => location.reload(), 1500);
                } else {
                    alert('❌ Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('❌ Error removing label: ' + error.message);
            });
        }

        function cleanDataLists() {
            if (!confirm('This will remove orphaned entries from train/test/validation lists. Continue?')) {
                return;
            }
            
            fetch('/clean_data_lists', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let message = `✅ ${data.message}\n\nDetails:\n`;
                    
                    for (const [listName, stats] of Object.entries(data.results)) {
                        message += `\n${listName}: ${stats.original} → ${stats.valid} (removed ${stats.removed})`;
                    }
                    
                    alert(message);
                    
                    if (Object.values(data.results).some(r => r.removed > 0)) {
                        showAutoUpdateNotification();
                        setTimeout(() => location.reload(), 1500);
                    }
                } else {
                    alert('❌ Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('❌ Error cleaning lists: ' + error.message);
            });
        }

        // Load label management on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadLabelManagement();
        });

    </script>
</body>
</html>